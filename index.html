<html>

<head>
        <style>
                table, th, td {
                    border: 1px solid black;
                    border-collapse: collapse;
                }
                th, td {
                    padding: 15px;
                }
                </style>


</head>

<body>
<div style="width: 100%; height: 74px; border-bottom: 1px solid #ccc; margin-bottom:1em;">
    <div style="width: 100%; margin: 0 auto;">
        <div style="width: 810px; float: left;">
            <h1 style="margin: .24em 0; font-family: Ubuntu, arial, helvetica, sans-serif; letter-spacing: -1px; color: #aaa;">
                <img src="pharmbio_logo.png" style="position: relative; top: 6px; height: 36px; margin-right: .2em;">pharm<span style="color: #c00"><span>b.io</span></span> 
                <span style="color: black; margin-left: 2em;color: #444;">Docking Profile as a Service (DPAAS)</span></h1>
           
        </div>
                
        <div style="width: 64px; float: right;">
            <img src="uu_logo.png">
        </div>
    </div>
</div>

	<noscript>
		<div
			style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
			Your web browser must have JavaScript enabled in order for this
			application to display correctly.</div>
	</noscript>

    <div style="width: 44%; background-color: white; padding: 4px; font-family: sans-serif; float:left;">
        <h3 style="margin-top: 0">DPAAS - Docking Profile as a Service</h3>
        <i>Instructions</i>: Please enter one Smiles per line in the text box on the right and press Search Profile.
        
        <p>
         Initially the service is available for compound profiles against 10 receptor models. Each model was trained using 2.2 million compounds from SureChEMBL molecule library. 
         The models were created using our modelling strategy given in paper <b>"Efficient iterative Virtual Screening with 
         Apache Spark and Conformal Prediction"</b> accepted in Journal of Cheminformatics.
       
        <p>
        <b>Structure Based Docking Profile Predictions based on CPVS</b><br>
        Laeeq Ahmed, Staffan Arvidsson, Arvid Berg, Jonathan Alvarsson, Wesley Schaal and Ola Spjuth<br>
        [<i>In Progress</i>]
    </div>
    
    <div class="panel-body" style="float:right; padding: 10px; font-family: sans-serif;">
            <div class="form-group">
                <textarea class="form-control" name="smiles" id="smiles" style="white-space: pre-wrap; width: 1000px; height: 220px; border-radius: 5px; resize: vertical;"  placeholder="SMILES here, one identifier per Line"></textarea>
            </div>
            <button type="button" onclick=master()>Search Profile</button>
    </div>
    <div>

        <textarea id="demo" style="width: 600px; height: 220px;">Display Json Here</textarea>

    </div>

    <div>

            <table id="myTable"></table>
    </div>    
   
        <script>
            var numOfReceptors = 1;
            function master(){
                

                //get predictions
                var url1 = "http://receptor1-cpvs-api.os.pharmb.io/predictions/?smiles=" + encodeURIComponent(document.getElementById('smiles').value)
                var predictions = getPredictions(url1, drawAndFillGrid)
                 
                //Draw Grid or table based on response
                //Fill in the grid with json response and dock button
                //call dock apiEndPoint on dock button    
            }
            function getPredictions(url,cFunction){
        
                var xmlhttp = new XMLHttpRequest();
                var response;
                xmlhttp.onreadystatechange = function() {
                    
                    if (this.readyState == 4 && this.status == 200) {
                        cFunction(this);
                    }else if(this.readyState == 4 && this.status == 400) 
                    {
                        document.getElementById("demo").innerHTML =  this.responseText;
                    }
                        
                    
                }; 
                xmlhttp.open( "GET", url , true );
                xmlhttp.send(null);
                alert("From getPredictions")
            }
            
            function drawAndFillGrid(xmlhttp) {
                // action goes here
                alert("From drawAndFillGrid")
                var jsonObj = JSON.parse(xmlhttp.responseText);
                //Use numOfReceptors for coloums and
                //jsonpredictions.length for rows
                //Add extra row for Dock buttons,
                //based on row, coloum, given buttons their id
                
                //First empty the ols table
                for(var i = document.getElementById("myTable").rows.length; i > 0;i--)
                {
                    document.getElementById("myTable").deleteRow(i -1);
                }
                document.getElementById("demo").innerHTML =  xmlhttp.responseText;
                    


                    var row = document.getElementById('myTable').insertRow(0);
                    //Smiles ID at 0,0
                    row.insertCell(0).innerHTML = "Smiles ID"
                    //Filling the Smiles ID's in coloumn 1r,0c;2r,0c,3r,0c . . . .  
                    for (var r = 1; r<=parseInt(jsonObj.predictions.length,10); r++ )
                        {
                            row = document.getElementById('myTable').insertRow(r);
                            row.insertCell(0).innerHTML = jsonObj.predictions[r-1].l_id;
                   
                        }
                        
                    /*for (var col = 1, row = 0; col<=parseInt(numOfReceptors,10);col++)
                        {
                            var z = row.insertCell(col);
                            z.innerHTML=jsonObj.predictions[0].r_pdbCode;
                        }    
                     */       
                    /*    
                    for(var r=1;r<=parseInt(jsonObj.predictions.length,10);r++)
                    {
                        var x=document.getElementById('myTable').insertRow(r);
                        for(var c=0;c<parseInt(numOfReceptors,10);c++)  
                        {
                            var y=  x.insertCell(c);
                            y.innerHTML="Row-"+r+" Column-"+c; 
                        }
                    }*/
            }

           
        </script>



    <div id="error_label" style="color:red"></div>
    <img id="image" style="display: block; margin: auto;"></img>
</body>
</html>